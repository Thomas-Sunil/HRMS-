@model hrms.Models.Employee

@{
    ViewData["Title"] = "My Attendance";

    // --- THIS IS THE FIX ---
    // Dynamically select the layout based on the logged-in user's role.
    var userRole = User.Claims.FirstOrDefault(c => c.Type == System.Security.Claims.ClaimTypes.Role)?.Value;
    string layout = userRole switch
    {
        "hr" => "_HrLayout.cshtml",
        "manager" => "_ManagerLayout.cshtml",
        _ => "_EmployeeLayout.cshtml" // Default for employees and others
    };
    Layout = $"~/Views/Shared/{layout}";
    // --- END FIX ---
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-3">
        @if (Model != null)
        {
            <h2>Attendance Calendar for @Model.FullName</h2>
        }
    </div>

    <div class="table-container p-3">
        <div id="attendance-calendar"></div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('attendance-calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek'
                },
                events: '/Employee/GetMyAttendanceData'
            });
            calendar.render();
        });
    </script>
}