@model hrms.Models.LeaveRequestViewModel

@{
    ViewData["Title"] = "Apply for Leave";
    var userRole = User.Claims.FirstOrDefault(c => c.Type == System.Security.Claims.ClaimTypes.Role)?.Value;
    string layout = userRole switch { "hr" => "_HrLayout.cshtml", "manager" => "_ManagerLayout.cshtml", _ => "_EmployeeLayout.cshtml" };
    Layout = $"~/Views/Shared/{layout}";
}

<div class="container-fluid">
    <div class="table-container p-4">
        <h2 class="mb-4">Apply for Leave</h2>
        <form asp-action="Apply" method="post">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <!-- Type and Duration Row -->
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label asp-for="LeaveType" class="control-label"></label>
                    <select asp-for="LeaveType" class="form-control">
                        <option value="">-- Select Type --</option>
                        <option value="Casual Leave">Casual Leave</option>
                        <option value="Medical Leave">Medical Leave</option>
                    </select>
                    <span asp-validation-for="LeaveType" class="text-danger"></span>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="control-label">Duration</label>
                    <div class="mt-2">
                        <div class="form-check form-check-inline">
                            <input asp-for="DurationType" type="radio" class="form-check-input" value="Full Day" id="fullDay" checked />
                            <label for="fullDay" class="form-check-label">Full Day(s)</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input asp-for="DurationType" type="radio" class="form-check-input" value="Half Day - First Half" id="halfDayFirst" />
                            <label for="halfDayFirst" class="form-check-label">First Half</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input asp-for="DurationType" type="radio" class="form-check-input" value="Half Day - Second Half" id="halfDaySecond" />
                            <label for="halfDaySecond" class="form-check-label">Second Half</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Date Row -->
            <div class="row">
                <div class="col-md-6 mb-3" id="startDateContainer">
                    <label asp-for="StartDate" class="control-label" id="startDateLabel">Date</label>
                    <input asp-for="StartDate" type="date" class="form-control" />
                    <span asp-validation-for="StartDate" class="text-danger"></span>
                </div>
                <div class="col-md-6 mb-3" id="endDateContainer">
                    <label asp-for="EndDate" class="control-label"></label>
                    <input asp-for="EndDate" type="date" class="form-control" />
                    <span asp-validation-for="EndDate" class="text-danger"></span>
                </div>
            </div>

            <div class="form-group mb-3">
                <label asp-for="Reason" class="control-label"></label>
                <textarea asp-for="Reason" class="form-control" rows="3"></textarea>
            </div>
            <div class="form-group"><input type="submit" value="Submit Request" class="btn btn-primary" /></div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const durationRadios = document.querySelectorAll('input[name="DurationType"]');
            const startDateContainer = document.getElementById('startDateContainer');
            const startDateLabel = document.getElementById('startDateLabel');
            const endDateContainer = document.getElementById('endDateContainer');
            const endDateInput = document.getElementById('EndDate');

            function toggleEndDateVisibility() {
                const selectedDuration = document.querySelector('input[name="DurationType"]:checked').value;
                if (selectedDuration.startsWith('Half Day')) {
                    endDateContainer.style.display = 'none';
                    startDateLabel.textContent = 'Date';
                } else {
                    endDateContainer.style.display = 'block';
                    startDateLabel.textContent = 'Start Date';
                }
            }

            durationRadios.forEach(radio => radio.addEventListener('change', toggleEndDateVisibility));

            // Initial check on page load
            toggleEndDateVisibility();
        });
    </script>
}